{% extends 'base.html' %}

{% block page_title %}{{ lesson.title }}{% endblock %}
{% block page_description %}–ò–∑—É—á–∏—Ç–µ —Ç–µ–æ—Ä–∏—é –∏ –ø—Ä–æ–π–¥–∏—Ç–µ —Ç–µ—Å—Ç{% endblock %}

{% block content %}

<div class="card">
    <h2>{{ lesson.title }}</h2>
    <div style="color: var(--color-text-muted); margin-bottom: 24px;">
        üìÖ {{ lesson.date|date:"d.m.Y" }} | ‚è±Ô∏è {{ lesson.duration_minutes }} –º–∏–Ω
    </div>
    
    <!-- –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–π –º–∞—Ç–µ—Ä–∏–∞–ª -->
    <div style="padding: 24px; background: var(--color-bg-tertiary); border-radius: 12px; margin-bottom: 32px;">
        {{ lesson.theory_content|safe }}
    </div>
</div>

<!-- –¢–µ—Å—Ç -->
<div class="card">
    <h2>üìù –¢–µ—Å—Ç –ø–æ —Ç–µ–º–µ —É—Ä–æ–∫–∞</h2>
    <p style="color: var(--color-text-muted); margin-bottom: 8px;">–í—Ä–µ–º—è –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ: {{ lesson.test_duration_minutes }} –º–∏–Ω—É—Ç</p>
    
    {% if already_submitted %}
        <div style="padding: 24px; background: #E8F5E9; border: 2px solid #4CAF50; border-radius: 12px; text-align: center; margin-top: 24px;">
            <p style="font-size: 20px; color: #2E7D32; margin-bottom: 16px;">‚úÖ –¢–µ—Å—Ç —É–∂–µ —Å–¥–∞–Ω!</p>
            <a href="{% url 'lesson_result' lesson.date %}" style="display: inline-block; padding: 12px 24px; background: #4CAF50; color: white; text-decoration: none; border-radius: 8px; font-weight: 600;">
                –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            </a>
        </div>
    {% else %}
        <form method="post" style="margin-top: 24px;">
            {% csrf_token %}
            
            {% for task in tasks %}
            <div style="padding: 24px; background: {% if task.difficulty == 'hard' %}#FFF3E0{% else %}#F5F7FA{% endif %}; border-radius: 12px; margin-bottom: 20px; border: 2px solid {% if task.difficulty == 'hard' %}#FF6B35{% else %}var(--color-border){% endif %};">
                
                {% if task.difficulty == 'hard' %}
                <div style="background: #FF6B35; color: white; padding: 8px 16px; border-radius: 6px; display: inline-block; margin-bottom: 12px; font-weight: 600; font-size: 14px;">
                    ‚≠ê –ü–û–í–´–®–ï–ù–ù–ê–Ø –°–õ–û–ñ–ù–û–°–¢–¨ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è 7)
                </div>
                {% endif %}
                
                <p style="font-weight: 600; color: var(--color-accent-primary); margin-bottom: 16px; font-size: 18px;">
                    –ó–∞–¥–∞–Ω–∏–µ {{ forloop.counter }} –∏–∑ {{ tasks|length }}
                </p>
                
                <!-- –ó–∞–¥–∞–Ω–∏–µ –Ω–∞ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—é (—É—Ä–æ–∫ 1) -->
                {% if task.type == 'classify' %}
                <p style="font-size: 16px; margin-bottom: 12px;">
                    –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –¥—Ä–æ–±—å <code style="font-size: 20px; background: white; padding: 4px 12px; border-radius: 6px; color: var(--color-accent-primary);">{{ task.numerator }}/{{ task.denominator }}</code> –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π?
                </p>
                <select name="answer_{{ forloop.counter0 }}" required style="width: 100%; padding: 12px; border: 2px solid var(--color-border); border-radius: 8px; font-size: 16px; background: white;">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–≤–µ—Ç...</option>
                    <option value="proper">–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è</option>
                    <option value="improper">–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è</option>
                </select>
                
                <!-- –°–º–µ—à–∞–Ω–Ω–∞—è ‚Üí –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è (—É—Ä–æ–∫ 1) -->
                {% elif task.type == 'mixed_to_improper' %}
                <p style="font-size: 16px; margin-bottom: 12px;">
                    –ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ —Å–º–µ—à–∞–Ω–Ω—É—é –¥—Ä–æ–±—å –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—É—é:
                    <code style="font-size: 20px; background: white; padding: 4px 12px; border-radius: 6px; color: var(--color-accent-primary);">{{ task.whole }} {{ task.numerator }}/{{ task.denominator }}</code>
                </p>
                <p style="font-size: 14px; color: var(--color-text-muted); margin-bottom: 12px;">–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞: —á–∏—Å–ª–∏—Ç–µ–ª—å/–∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, 15/4)</p>
                <input type="text" name="answer_{{ forloop.counter0 }}" required placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç..." style="width: 100%; padding: 12px; border: 2px solid var(--color-border); border-radius: 8px; font-size: 16px;">
                
                <!-- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è ‚Üí —Å–º–µ—à–∞–Ω–Ω–∞—è (—É—Ä–æ–∫ 1) -->
                {% elif task.type == 'improper_to_mixed' %}
                <p style="font-size: 16px; margin-bottom: 12px;">
                    –ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—É—é –¥—Ä–æ–±—å –≤ —Å–º–µ—à–∞–Ω–Ω—É—é:
                    <code style="font-size: 20px; background: white; padding: 4px 12px; border-radius: 6px; color: var(--color-accent-primary);">{{ task.numerator }}/{{ task.denominator }}</code>
                </p>
                <p style="font-size: 14px; color: var(--color-text-muted); margin-bottom: 12px;">–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞: —Ü–µ–ª–∞—è —á–∞—Å—Ç—å –ø—Ä–æ–±–µ–ª —á–∏—Å–ª–∏—Ç–µ–ª—å/–∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, 3 3/4)</p>
                <input type="text" name="answer_{{ forloop.counter0 }}" required placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç..." style="width: 100%; padding: 12px; border: 2px solid var(--color-border); border-radius: 8px; font-size: 16px;">
                
                <!-- –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –¥—Ä–æ–±–µ–π (—É—Ä–æ–∫ 2) -->
                {% elif task.type == 'reduce' or task.type == 'reduce_hard' %}
                <p style="font-size: 16px; margin-bottom: 12px;">
                    –°–æ–∫—Ä–∞—Ç–∏—Ç–µ –¥—Ä–æ–±—å:
                    <code style="font-size: 20px; background: white; padding: 4px 12px; border-radius: 6px; color: var(--color-accent-primary);">{{ task.numerator }}/{{ task.denominator }}</code>
                </p>
                <p style="font-size: 14px; color: var(--color-text-muted); margin-bottom: 12px;">–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞: —á–∏—Å–ª–∏—Ç–µ–ª—å/–∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, 2/3)</p>
                <input type="text" name="answer_{{ forloop.counter0 }}" required placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç..." style="width: 100%; padding: 12px; border: 2px solid var(--color-border); border-radius: 8px; font-size: 16px;">
                
                <!-- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª–µ–º (—É—Ä–æ–∫ 2) -->
                {% elif task.type == 'compare_same_denom' %}
                <p style="font-size: 16px; margin-bottom: 12px;">
                    –°—Ä–∞–≤–Ω–∏—Ç–µ –¥—Ä–æ–±–∏:
                    <code style="font-size: 20px; background: white; padding: 4px 12px; border-radius: 6px; color: var(--color-accent-primary);">{{ task.numerator1 }}/{{ task.denominator1 }}</code>
                    <span style="font-size: 20px; margin: 0 8px;">___</span>
                    <code style="font-size: 20px; background: white; padding: 4px 12px; border-radius: 6px; color: var(--color-accent-primary);">{{ task.numerator2 }}/{{ task.denominator2 }}</code>
                </p>
                <select name="answer_{{ forloop.counter0 }}" required style="width: 100%; padding: 12px; border: 2px solid var(--color-border); border-radius: 8px; font-size: 16px; background: white;">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∑–Ω–∞–∫...</option>
                    <option value=">">></option>
                    <option value="<"><</option>
                    <option value="=">=</option>
                </select>
                
                <!-- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Ä–∞–∑–Ω—ã–º–∏ –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—è–º–∏ (—É—Ä–æ–∫ 2) -->
                {% elif task.type == 'compare_diff_denom' %}
                <p style="font-size: 16px; margin-bottom: 12px;">
                    –°—Ä–∞–≤–Ω–∏—Ç–µ –¥—Ä–æ–±–∏ (–ø—Ä–∏–≤–µ–¥–∏—Ç–µ –∫ –æ–±—â–µ–º—É –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—é):
                    <code style="font-size: 20px; background: white; padding: 4px 12px; border-radius: 6px; color: var(--color-accent-primary);">{{ task.numerator1 }}/{{ task.denominator1 }}</code>
                    <span style="font-size: 20px; margin: 0 8px;">___</span>
                    <code style="font-size: 20px; background: white; padding: 4px 12px; border-radius: 6px; color: var(--color-accent-primary);">{{ task.numerator2 }}/{{ task.denominator2 }}</code>
                </p>
                <select name="answer_{{ forloop.counter0 }}" required style="width: 100%; padding: 12px; border: 2px solid var(--color-border); border-radius: 8px; font-size: 16px; background: white;">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∑–Ω–∞–∫...</option>
                    <option value=">">></option>
                    <option value="<"><</option>
                    <option value="=">=</option>
                </select>
                
                {% endif %}
            </div>
            {% endfor %}
            
            <div style="margin-top: 32px; text-align: center;">
                <button type="submit" style="padding: 16px 48px; background: var(--color-accent-primary); color: white; border: none; border-radius: 12px; font-size: 18px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(25, 118, 210, 0.3);">
                    ‚úÖ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É
                </button>
            </div>
        </form>
    {% endif %}
</div>

<style>
    code {
        font-family: 'Courier New', monospace;
    }
    
    button:hover {
        background: var(--color-accent-hover);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(25, 118, 210, 0.5);
    }
    
    button:active {
        transform: translateY(0);
    }
    
    input:focus, select:focus {
        outline: none;
        border-color: var(--color-accent-primary);
        box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.2);
    }
</style>

{% endblock %}
