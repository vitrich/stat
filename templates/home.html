{% extends 'base.html' %}

{% block page_title %}–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞{% endblock %}
{% block page_description %}{% if user.is_authenticated %}–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.student.full_name }}!{% else %}–°–∏—Å—Ç–µ–º–∞ –æ–±—É—á–µ–Ω–∏—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ{% endif %}{% endblock %}

{% block content %}

{% if user.is_authenticated and student %}
<!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –¥–µ—Ç–µ–π -->
<div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none;">
    <h2 style="color: white; font-size: 28px; margin-bottom: 20px;">üìö –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞</h2>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 24px;">
        <div style="background: rgba(255, 255, 255, 0.15); padding: 20px; border-radius: 12px; backdrop-filter: blur(10px);">
            <div style="font-size: 32px; margin-bottom: 10px;">1Ô∏è‚É£</div>
            <h3 style="color: white; margin-bottom: 8px;">–í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–∫</h3>
            <p style="opacity: 0.9; font-size: 14px;">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —É—Ä–æ–∫ –∏–∑ —Å–ø–∏—Å–∫–∞ –Ω–∏–∂–µ, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å</p>
        </div>
        
        <div style="background: rgba(255, 255, 255, 0.15); padding: 20px; border-radius: 12px; backdrop-filter: blur(10px);">
            <div style="font-size: 32px; margin-bottom: 10px;">2Ô∏è‚É£</div>
            <h3 style="color: white; margin-bottom: 8px;">–ò–∑—É—á–∏—Ç–µ —Ç–µ–æ—Ä–∏—é</h3>
            <p style="opacity: 0.9; font-size: 14px;">–ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª —É—Ä–æ–∫–∞ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ</p>
        </div>
        
        <div style="background: rgba(255, 255, 255, 0.15); padding: 20px; border-radius: 12px; backdrop-filter: blur(10px);">
            <div style="font-size: 32px; margin-bottom: 10px;">3Ô∏è‚É£</div>
            <h3 style="color: white; margin-bottom: 8px;">–ü—Ä–æ–π–¥–∏—Ç–µ —Ç–µ—Å—Ç</h3>
            <p style="opacity: 0.9; font-size: 14px;">–û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –∏ –ø–æ–ª—É—á–∏—Ç–µ –æ—Ü–µ–Ω–∫—É</p>
        </div>
        
        <div style="background: rgba(255, 255, 255, 0.15); padding: 20px; border-radius: 12px; backdrop-filter: blur(10px);">
            <div style="font-size: 32px; margin-bottom: 10px;">4Ô∏è‚É£</div>
            <h3 style="color: white; margin-bottom: 8px;">–°–º–æ—Ç—Ä–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç</h3>
            <p style="opacity: 0.9; font-size: 14px;">–í–∞—à–∞ –æ—Ü–µ–Ω–∫–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–µ</p>
        </div>
    </div>
    
    <div style="margin-top: 24px; padding: 16px; background: rgba(255, 255, 255, 0.2); border-radius: 8px; border-left: 4px solid #FFD700;">
        <p style="font-size: 16px; margin: 0;">
            <strong>üí° –í–∞–∂–Ω–æ:</strong> –ü–æ—Å–ª–µ–¥–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ –≤ —Ç–µ—Å—Ç–µ –ø–æ–≤—ã—à–µ–Ω–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏. –û–Ω–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ü–µ–Ω–∫–∏ 7!
        </p>
    </div>
</div>

<!-- –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —É—Ä–æ–∫–æ–≤ -->
<div class="card">
    <h2>üìñ –î–æ—Å—Ç—É–ø–Ω—ã–µ —É—Ä–æ–∫–∏</h2>
    <p style="color: var(--color-text-muted); margin-bottom: 24px;">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —É—Ä–æ–∫, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∏–∑—É—á–µ–Ω–∏–µ</p>
    
    {% if lessons %}
    <div style="display: flex; flex-direction: column; gap: 16px;">
        {% for lesson in lessons %}
        <a href="{% url 'lesson_view' lesson.date %}" style="text-decoration: none; color: inherit;">
            <div style="padding: 20px; border: 2px solid {% if lesson.completed %}#4CAF50{% else %}var(--color-border){% endif %}; border-radius: 12px; transition: all 0.3s ease; background: {% if lesson.completed %}rgba(76, 175, 80, 0.05){% else %}white{% endif %}; cursor: pointer;">
                <div style="display: flex; align-items: center; justify-content: space-between;">
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                            <span style="font-size: 32px;">{% if lesson.completed %}‚úÖ{% else %}üìù{% endif %}</span>
                            <h3 style="color: var(--color-accent-primary); margin: 0; font-size: 20px;">{{ lesson.title }}</h3>
                        </div>
                        
                        <div style="display: flex; gap: 16px; color: var(--color-text-muted); font-size: 14px; margin-bottom: 8px;">
                            <span>üìÖ {{ lesson.date|date:"d.m.Y" }}</span>
                            <span>‚è±Ô∏è {{ lesson.duration_minutes }} –º–∏–Ω</span>
                            <span>üìù –¢–µ—Å—Ç: {{ lesson.test_duration_minutes }} –º–∏–Ω</span>
                        </div>
                        
                        {% if lesson.completed and lesson.score %}
                        <div style="display: inline-block; padding: 4px 12px; background: {% if lesson.score >= 6 %}#4CAF50{% elif lesson.score >= 4 %}#FFA726{% else %}#EF5350{% endif %}; color: white; border-radius: 6px; font-weight: 600; font-size: 14px; margin-top: 8px;">
                            –û—Ü–µ–Ω–∫–∞: {{ lesson.score }}/7
                        </div>
                        {% endif %}
                    </div>
                    
                    <div style="text-align: center; padding: 16px; background: {% if lesson.completed %}#4CAF50{% else %}var(--color-orange){% endif %}; color: white; border-radius: 12px; min-width: 120px;">
                        <div style="font-size: 14px; opacity: 0.9; margin-bottom: 4px;">
                            {% if lesson.completed %}–ü—Ä–æ–π–¥–µ–Ω–æ{% else %}–î–æ—Å—Ç—É–ø–Ω–æ{% endif %}
                        </div>
                        <div style="font-size: 18px; font-weight: 600;">
                            {% if lesson.completed %}
                                –†–µ–∑—É–ª—å—Ç–∞—Ç—ã ‚Üí
                            {% else %}
                                –ù–∞—á–∞—Ç—å ‚Üí
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </a>
        {% endfor %}
    </div>
    {% else %}
    <div style="text-align: center; padding: 40px; color: var(--color-text-muted);">
        <p style="font-size: 18px;">üìö –ü–æ–∫–∞ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —É—Ä–æ–∫–æ–≤</p>
        <p style="font-size: 14px; margin-top: 8px;">–£—Ä–æ–∫–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å, –∫–æ–≥–¥–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –∏—Ö —Å–æ–∑–¥–∞—Å—Ç</p>
    </div>
    {% endif %}
</div>

<!-- –í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å -->
{% if lessons %}
<div class="card">
    <h2>üìä –í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å</h2>
    <div style="margin-top: 16px;">
        {% with total=lessons|length completed=lessons|selectattr:"completed"|list|length %}
        <div style="margin-bottom: 16px;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                <span style="font-weight: 500;">–ü—Ä–æ–π–¥–µ–Ω–æ —É—Ä–æ–∫–æ–≤:</span>
                <span style="color: var(--color-accent-primary); font-weight: 600;">{{ completed }} –∏–∑ {{ total }}</span>
            </div>
            <div style="width: 100%; height: 24px; background: var(--color-bg-tertiary); border-radius: 12px; overflow: hidden;">
                <div style="width: {% widthratio completed total 100 %}%; height: 100%; background: linear-gradient(90deg, #4CAF50 0%, #8BC34A 100%); transition: width 0.5s ease;"></div>
            </div>
        </div>
        
        {% if completed > 0 %}
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-top: 24px;">
            <div style="text-align: center; padding: 16px; background: var(--color-bg-tertiary); border-radius: 8px;">
                <div style="font-size: 32px; font-weight: 700; color: var(--color-accent-primary);">{{ completed }}</div>
                <div style="font-size: 14px; color: var(--color-text-muted);">–ü—Ä–æ–π–¥–µ–Ω–æ</div>
            </div>
            <div style="text-align: center; padding: 16px; background: var(--color-bg-tertiary); border-radius: 8px;">
                <div style="font-size: 32px; font-weight: 700; color: var(--color-orange);">{{ total|add:"-"|add:completed }}</div>
                <div style="font-size: 14px; color: var(--color-text-muted);">–û—Å—Ç–∞–ª–æ—Å—å</div>
            </div>
            <div style="text-align: center; padding: 16px; background: var(--color-bg-tertiary); border-radius: 8px;">
                <div style="font-size: 32px; font-weight: 700; color: var(--color-success);">{% widthratio completed total 100 %}%</div>
                <div style="font-size: 14px; color: var(--color-text-muted);">–ü—Ä–æ–≥—Ä–µ—Å—Å</div>
            </div>
        </div>
        {% endif %}
        {% endwith %}
    </div>
</div>
{% endif %}

{% else %}
<!-- –ì–æ—Å—Ç–µ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (–µ—Å–ª–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω) -->
<div class="card" style="text-align: center; padding: 60px 40px;">
    <h2 style="font-size: 36px; color: var(--color-accent-primary); margin-bottom: 16px;">üìê –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
    <p style="font-size: 18px; color: var(--color-text-secondary); margin-bottom: 32px;">
        –°–∏—Å—Ç–µ–º–∞ –æ–±—É—á–µ–Ω–∏—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ –¥–ª—è —É—á–µ–Ω–∏–∫–æ–≤ 5 –∫–ª–∞—Å—Å–∞ –õ–µ—Ç–æ–≤–æ
    </p>
    
    <div style="display: flex; gap: 16px; justify-content: center;">
        <a href="{% url 'login' %}" style="padding: 14px 32px; background: var(--color-accent-primary); color: white; text-decoration: none; border-radius: 8px; font-weight: 600; transition: all 0.3s ease;">
            üîë –í–æ–π—Ç–∏
        </a>
        <a href="{% url 'register' %}" style="padding: 14px 32px; background: var(--color-orange); color: white; text-decoration: none; border-radius: 8px; font-weight: 600; transition: all 0.3s ease;">
            ‚ú® –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
        </a>
    </div>
</div>

<div class="card">
    <h3 style="color: var(--color-accent-primary); margin-bottom: 16px;">‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã</h3>
    <ul style="list-style: none; padding: 0;">
        <li style="padding: 12px 0; border-bottom: 1px solid var(--color-border);">üìñ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —É—Ä–æ–∫–∏ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏</li>
        <li style="padding: 12px 0; border-bottom: 1px solid var(--color-border);">üìù –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–∞–Ω–∏–π</li>
        <li style="padding: 12px 0; border-bottom: 1px solid var(--color-border);">üìä –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</li>
        <li style="padding: 12px 0;">üéØ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—á–µ–Ω–∏–∫–∞</li>
    </ul>
</div>
{% endif %}

<style>
    a:hover > div {
        transform: translateY(-4px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
    }
</style>

{% endblock %}
