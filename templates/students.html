{% extends 'base.html' %}

{% block page_title %}–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —É—á–µ–Ω–∏–∫–æ–≤{% endblock %}
{% block page_description %}–¢–∞–±–ª–∏—Ü–∞ –æ—Ü–µ–Ω–æ–∫ —É—á–µ–Ω–∏–∫–æ–≤ –≤–∞—à–∏—Ö –≥—Ä—É–ø–ø{% endblock %}

{% block content %}

<div class="card">
    <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —É—á–µ–Ω–∏–∫–æ–≤ –ø–æ —É—Ä–æ–∫–∞–º</h2>
    <p style="color: var(--color-text-muted); margin-bottom: 24px;">
        –û—Ü–µ–Ω–∫–∏ —É—á–µ–Ω–∏–∫–æ–≤ –∏–∑ –≤–∞—à–∏—Ö –≥—Ä—É–ø–ø: 
        {% for group in teacher_groups %}
            <span style="background: var(--color-bg-tertiary); padding: 4px 12px; border-radius: 6px; margin: 0 4px;">–ì—Ä—É–ø–ø–∞ {{ group.number }}</span>
        {% endfor %}
    </p>
    
    {% if results_table %}
    <div style="overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse; min-width: 800px;">
            <thead>
                <tr style="background: var(--color-bg-tertiary);">
                    <th style="padding: 16px; text-align: left; border-bottom: 2px solid var(--color-border); position: sticky; left: 0; background: var(--color-bg-tertiary); z-index: 10; min-width: 200px;">
                        üë§ –£—á–µ–Ω–∏–∫
                    </th>
                    <th style="padding: 16px; text-align: center; border-bottom: 2px solid var(--color-border); min-width: 80px;">
                        üìå –ö–ª–∞—Å—Å
                    </th>
                    <th style="padding: 16px; text-align: center; border-bottom: 2px solid var(--color-border); min-width: 100px;">
                        üéØ –ì—Ä—É–ø–ø–∞
                    </th>
                    {% for lesson in lessons %}
                    <th style="padding: 16px; text-align: center; border-bottom: 2px solid var(--color-border); min-width: 150px;">
                        <div style="font-weight: 600; color: var(--color-accent-primary); margin-bottom: 4px;">
                            {{ lesson.title|truncatewords:3 }}
                        </div>
                        <div style="font-size: 12px; color: var(--color-text-muted); font-weight: normal;">
                            {{ lesson.date|date:"d.m.Y" }}
                        </div>
                    </th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for student_data in results_table %}
                <tr style="border-bottom: 1px solid var(--color-border); transition: background 0.2s ease;">
                    <td style="padding: 16px; font-weight: 600; position: sticky; left: 0; background: white; z-index: 5;">
                        {{ student_data.student.full_name }}
                    </td>
                    <td style="padding: 16px; text-align: center; color: var(--color-text-secondary);">
                        {{ student_data.student.class_name|default:"‚Äî" }}
                    </td>
                    <td style="padding: 16px; text-align: center;">
                        <span style="background: var(--color-accent-primary); color: white; padding: 4px 12px; border-radius: 6px; font-size: 14px; font-weight: 600;">
                            {{ student_data.student.current_group.number|default:"‚Äî" }}
                        </span>
                    </td>
                    {% for result in student_data.results %}
                    <td style="padding: 16px; text-align: center;">
                        {% if result.submitted %}
                            {% if result.score %}
                                <div style="display: inline-block; padding: 8px 16px; border-radius: 8px; font-weight: 700; font-size: 18px; min-width: 50px;
                                    {% if result.score >= 6 %}
                                        background: #4CAF50; color: white;
                                    {% elif result.score >= 4 %}
                                        background: #FFA726; color: white;
                                    {% else %}
                                        background: #EF5350; color: white;
                                    {% endif %}
                                ">
                                    {{ result.score }}
                                </div>
                            {% else %}
                                <span style="color: var(--color-text-muted); font-size: 14px;">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
                            {% endif %}
                        {% else %}
                            <span style="color: var(--color-text-muted); font-size: 24px;">‚Äî</span>
                        {% endif %}
                    </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- –õ–µ–≥–µ–Ω–¥–∞ –æ—Ü–µ–Ω–æ–∫ -->
    <div style="margin-top: 24px; padding: 20px; background: var(--color-bg-tertiary); border-radius: 12px;">
        <h3 style="color: var(--color-accent-primary); margin-bottom: 16px; font-size: 16px;">üìã –®–∫–∞–ª–∞ –æ—Ü–µ–Ω–æ–∫</h3>
        <div style="display: flex; gap: 24px; flex-wrap: wrap;">
            <div style="display: flex; align-items: center; gap: 8px;">
                <div style="width: 40px; height: 40px; background: #4CAF50; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700;">7-6</div>
                <span>–û—Ç–ª–∏—á–Ω–æ (‚â•85%)</span>
            </div>
            <div style="display: flex; align-items: center; gap: 8px;">
                <div style="width: 40px; height: 40px; background: #FFA726; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700;">5-4</div>
                <span>–•–æ—Ä–æ—à–æ (50-84%)</span>
            </div>
            <div style="display: flex; align-items: center; gap: 8px;">
                <div style="width: 40px; height: 40px; background: #EF5350; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700;">3-1</div>
                <span>–ù—É–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å (<50%)</span>
            </div>
            <div style="display: flex; align-items: center; gap: 8px;">
                <div style="width: 40px; height: 40px; border: 2px dashed var(--color-border); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: var(--color-text-muted); font-weight: 700;">‚Äî</div>
                <span>–ù–µ —Å–¥–∞–Ω–æ</span>
            </div>
        </div>
    </div>
    
    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div style="margin-top: 24px; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
        <div style="padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; color: white;">
            <div style="font-size: 14px; opacity: 0.9; margin-bottom: 4px;">–í—Å–µ–≥–æ —É—á–µ–Ω–∏–∫–æ–≤</div>
            <div style="font-size: 36px; font-weight: 700;">{{ results_table|length }}</div>
        </div>
        <div style="padding: 20px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 12px; color: white;">
            <div style="font-size: 14px; opacity: 0.9; margin-bottom: 4px;">–£—Ä–æ–∫–æ–≤ —Å–æ–∑–¥–∞–Ω–æ</div>
            <div style="font-size: 36px; font-weight: 700;">{{ lessons|length }}</div>
        </div>
        <div style="padding: 20px; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border-radius: 12px; color: white;">
            <div style="font-size: 14px; opacity: 0.9; margin-bottom: 4px;">–í–∞—à–∏ –≥—Ä—É–ø–ø—ã</div>
            <div style="font-size: 36px; font-weight: 700;">{{ teacher_groups|length }}</div>
        </div>
    </div>
    
    {% else %}
    <div style="text-align: center; padding: 60px 20px; color: var(--color-text-muted);">
        <p style="font-size: 48px; margin-bottom: 16px;">üìö</p>
        <p style="font-size: 20px; margin-bottom: 8px;">–ù–µ—Ç —É—á–µ–Ω–∏–∫–æ–≤ –≤ –≤–∞—à–∏—Ö –≥—Ä—É–ø–ø–∞—Ö</p>
        <p style="font-size: 14px;">–ù–∞–∑–Ω–∞—á—å—Ç–µ —Å–µ–±—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–º –≥—Ä—É–ø–ø—ã –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏</p>
    </div>
    {% endif %}
</div>

<style>
    tbody tr:hover {
        background: var(--color-bg-tertiary) !important;
    }
    
    @media (max-width: 1200px) {
        table {
            font-size: 14px;
        }
        th, td {
            padding: 12px !important;
        }
    }
</style>

{% endblock %}
