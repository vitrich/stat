{% extends 'base.html' %}

{% block page_title %}–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤{% endblock %}
{% block page_description %}–ê–Ω–∞–ª–∏–∑ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π —É—á–µ–Ω–∏–∫–æ–≤ –º–µ–∂–¥—É –≥—Ä—É–ø–ø–∞–º–∏{% endblock %}

{% block content %}

<!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div class="card">
    <h2 style="color: var(--color-accent-primary); margin-bottom: 24px;">üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 24px;">
        <div style="background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%); padding: 20px; border-radius: 12px; border: 1px solid #90CAF9;">
            <div style="font-size: 32px; font-weight: 700; color: #1976D2; margin-bottom: 8px;">{{ total_transitions }}</div>
            <div style="color: #1565C0; font-size: 14px; font-weight: 500;">–í—Å–µ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤</div>
        </div>

        <div style="background: linear-gradient(135deg, #F3E5F5 0%, #E1BEE7 100%); padding: 20px; border-radius: 12px; border: 1px solid #CE93D8;">
            <div style="font-size: 32px; font-weight: 700; color: #7B1FA2; margin-bottom: 8px;">{{ group_stats|length }}</div>
            <div style="color: #6A1B9A; font-size: 14px; font-weight: 500;">–ê–∫—Ç–∏–≤–Ω—ã—Ö –≥—Ä—É–ø–ø</div>
        </div>

        <div style="background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%); padding: 20px; border-radius: 12px; border: 1px solid #A5D6A7;">
            <div style="font-size: 32px; font-weight: 700; color: #388E3C; margin-bottom: 8px;">{{ transitions|length }}</div>
            <div style="color: #2E7D32; font-size: 14px; font-weight: 500;">–£—á–µ–Ω–∏–∫–æ–≤ —Å –ø–µ—Ä–µ—Ö–æ–¥–∞–º–∏</div>
        </div>
    </div>
</div>

<!-- –¢–µ–∫—É—â–µ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –≥—Ä—É–ø–ø–∞–º -->
<div class="card">
    <h2 style="color: var(--color-accent-primary); margin-bottom: 20px;">üë• –¢–µ–∫—É—â–µ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ</h2>

    <div style="display: grid; gap: 16px;">
        {% for stat in group_stats %}
        <div style="background: var(--color-bg-secondary); padding: 16px; border-radius: 10px; border: 1px solid var(--color-border); display: flex; justify-content: space-between; align-items: center;">
            <div>
                <div style="font-size: 18px; font-weight: 600; color: var(--color-text-primary); margin-bottom: 4px;">
                    –ì—Ä—É–ø–ø–∞ {{ stat.group.number }}
                </div>
                <div style="color: var(--color-text-muted); font-size: 14px;">
                    {{ stat.teacher }}
                </div>
            </div>
            <div style="text-align: right;">
                <div style="font-size: 28px; font-weight: 700; color: var(--color-accent-primary);">
                    {{ stat.current_count }}
                </div>
                <div style="color: var(--color-text-muted); font-size: 12px;">
                    —É—á–µ–Ω–∏–∫–æ–≤
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- –ü–µ—Ä–µ—Ö–æ–¥—ã –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º -->
{% if transitions_by_direction %}
<div class="card">
    <h2 style="color: var(--color-accent-primary); margin-bottom: 20px;">üîÑ –ü–µ—Ä–µ—Ö–æ–¥—ã –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º</h2>

    <div style="display: grid; gap: 12px;">
        {% for direction, count in transitions_by_direction.items %}
        <div style="background: var(--color-blue-light); padding: 14px 18px; border-radius: 8px; border-left: 4px solid var(--color-accent-primary); display: flex; justify-content: space-between; align-items: center;">
            <div style="font-size: 16px; font-weight: 500; color: var(--color-text-primary);">
                {{ direction }}
            </div>
            <div style="background: var(--color-accent-primary); color: white; padding: 6px 16px; border-radius: 20px; font-weight: 600; font-size: 14px;">
                {{ count }} {% if count == 1 %}—É—á–µ–Ω–∏–∫{% elif count < 5 %}—É—á–µ–Ω–∏–∫–∞{% else %}—É—á–µ–Ω–∏–∫–æ–≤{% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- –î–µ—Ç–∞–ª—å–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ -->
{% if transitions %}
<div class="card">
    <h2 style="color: var(--color-accent-primary); margin-bottom: 20px;">üìã –î–µ—Ç–∞–ª—å–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤</h2>

    <div style="overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background: var(--color-bg-secondary); border-bottom: 2px solid var(--color-border);">
                    <th style="padding: 12px; text-align: left; font-weight: 600; color: var(--color-text-secondary); font-size: 13px;">‚Ññ</th>
                    <th style="padding: 12px; text-align: left; font-weight: 600; color: var(--color-text-secondary); font-size: 13px;">–£—á–µ–Ω–∏–∫</th>
                    <th style="padding: 12px; text-align: left; font-weight: 600; color: var(--color-text-secondary); font-size: 13px;">–ü–µ—Ä–µ—Ö–æ–¥</th>
                    <th style="padding: 12px; text-align: left; font-weight: 600; color: var(--color-text-secondary); font-size: 13px;">–î–∞—Ç–∞</th>
                    <th style="padding: 12px; text-align: left; font-weight: 600; color: var(--color-text-secondary); font-size: 13px;">–ü—Ä–∏—á–∏–Ω–∞</th>
                </tr>
            </thead>
            <tbody>
                {% for transition in transitions %}
                <tr style="border-bottom: 1px solid var(--color-border); transition: background 0.2s;" onmouseover="this.style.background='var(--color-blue-light)'" onmouseout="this.style.background='transparent'">
                    <td style="padding: 14px; color: var(--color-text-muted); font-size: 14px;">{{ forloop.counter }}</td>
                    <td style="padding: 14px; font-weight: 500; color: var(--color-text-primary); font-size: 14px;">
                        {{ transition.student.full_name }}
                    </td>
                    <td style="padding: 14px; font-size: 14px;">
                        <span style="display: inline-flex; align-items: center; gap: 8px;">
                            <span style="background: rgba(255, 107, 53, 0.15); color: #FF6B35; padding: 4px 12px; border-radius: 6px; font-weight: 600;">
                                –ì—Ä—É–ø–ø–∞ {{ transition.from_group.number }}
                            </span>
                            <span style="color: var(--color-text-muted);">‚Üí</span>
                            <span style="background: rgba(76, 175, 80, 0.15); color: #4CAF50; padding: 4px 12px; border-radius: 6px; font-weight: 600;">
                                –ì—Ä—É–ø–ø–∞ {{ transition.to_group.number }}
                            </span>
                        </span>
                    </td>
                    <td style="padding: 14px; color: var(--color-text-secondary); font-size: 14px;">
                        {{ transition.date|date:"d.m.Y" }}
                    </td>
                    <td style="padding: 14px; color: var(--color-text-muted); font-size: 13px; font-style: italic;">
                        {{ transition.reason }}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% else %}
<div class="card" style="text-align: center; padding: 48px 24px;">
    <div style="font-size: 48px; margin-bottom: 16px;">üìä</div>
    <h3 style="color: var(--color-text-secondary); font-weight: 500; margin-bottom: 8px;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø–µ—Ä–µ—Ö–æ–¥–∞—Ö</h3>
    <p style="color: var(--color-text-muted); font-size: 14px;">
        –ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –ø–æ–∫–∞ –Ω–µ –∑–∞–ø–∏—Å–∞–Ω–∞. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç <code style="background: var(--color-bg-secondary); padding: 4px 8px; border-radius: 4px;">add_december_history.py</code>
    </p>
</div>
{% endif %}

<!-- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Ç–æ–∫–æ–≤ (—É–ø—Ä–æ—â—ë–Ω–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞) -->
{% if transitions %}
<div class="card">
    <h2 style="color: var(--color-accent-primary); margin-bottom: 20px;">üåä –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Ç–æ–∫–æ–≤ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤</h2>

    <div style="background: var(--color-bg-secondary); padding: 24px; border-radius: 12px; border: 1px solid var(--color-border);">
        <svg width="100%" height="450" viewBox="0 0 900 450" style="max-width: 100%;">
            <!-- –î–µ–∫–∞–±—Ä—å (—Å–ª–µ–≤–∞) -->
            <text x="120" y="35" font-size="20" font-weight="700" fill="var(--color-text-primary)">16 –¥–µ–∫–∞–±—Ä—è 2025</text>

            <rect x="50" y="70" width="140" height="55" rx="10" fill="#E3F2FD" stroke="#1976D2" stroke-width="2"/>
            <text x="120" y="103" text-anchor="middle" font-size="16" font-weight="600" fill="#1976D2">–ì—Ä—É–ø–ø–∞ 1</text>

            <rect x="50" y="145" width="140" height="55" rx="10" fill="#F3E5F5" stroke="#7B1FA2" stroke-width="2"/>
            <text x="120" y="178" text-anchor="middle" font-size="16" font-weight="600" fill="#7B1FA2">–ì—Ä—É–ø–ø–∞ 2</text>

            <rect x="50" y="220" width="140" height="55" rx="10" fill="#E8F5E9" stroke="#388E3C" stroke-width="2"/>
            <text x="120" y="253" text-anchor="middle" font-size="16" font-weight="600" fill="#388E3C">–ì—Ä—É–ø–ø–∞ 2.1</text>

            <rect x="50" y="295" width="140" height="55" rx="10" fill="#FFF3E0" stroke="#F57C00" stroke-width="2"/>
            <text x="120" y="328" text-anchor="middle" font-size="16" font-weight="600" fill="#F57C00">–ì—Ä—É–ø–ø–∞ 2.2</text>

            <rect x="50" y="370" width="140" height="55" rx="10" fill="#FCE4EC" stroke="#C2185B" stroke-width="2"/>
            <text x="120" y="403" text-anchor="middle" font-size="16" font-weight="600" fill="#C2185B">–ì—Ä—É–ø–ø–∞ 3</text>

            <!-- –Ø–Ω–≤–∞—Ä—å (—Å–ø—Ä–∞–≤–∞) -->
            <text x="680" y="35" font-size="20" font-weight="700" fill="var(--color-text-primary)">12 —è–Ω–≤–∞—Ä—è 2026</text>

            <rect x="710" y="70" width="140" height="55" rx="10" fill="#E3F2FD" stroke="#1976D2" stroke-width="2"/>
            <text x="780" y="103" text-anchor="middle" font-size="16" font-weight="600" fill="#1976D2">–ì—Ä—É–ø–ø–∞ 1</text>

            <rect x="710" y="145" width="140" height="55" rx="10" fill="#F3E5F5" stroke="#7B1FA2" stroke-width="2"/>
            <text x="780" y="178" text-anchor="middle" font-size="16" font-weight="600" fill="#7B1FA2">–ì—Ä—É–ø–ø–∞ 2</text>

            <rect x="710" y="220" width="140" height="55" rx="10" fill="#E8F5E9" stroke="#388E3C" stroke-width="2"/>
            <text x="780" y="253" text-anchor="middle" font-size="16" font-weight="600" fill="#388E3C">–ì—Ä—É–ø–ø–∞ 2.1</text>

            <rect x="710" y="295" width="140" height="55" rx="10" fill="#FFF3E0" stroke="#F57C00" stroke-width="2"/>
            <text x="780" y="328" text-anchor="middle" font-size="16" font-weight="600" fill="#F57C00">–ì—Ä—É–ø–ø–∞ 2.2</text>

            <rect x="710" y="370" width="140" height="55" rx="10" fill="#FCE4EC" stroke="#C2185B" stroke-width="2"/>
            <text x="780" y="403" text-anchor="middle" font-size="16" font-weight="600" fill="#C2185B">–ì—Ä—É–ø–ø–∞ 3</text>

            <!-- –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç—Ä–µ–ª–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ -->
            <!-- 2 ‚Üí 1 -->
            <defs>
                <marker id="arrowhead1" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                    <polygon points="0 0, 10 3, 0 6" fill="#FF6B35" />
                </marker>
            </defs>
            <path d="M 190 172 Q 450 97 710 97" fill="none" stroke="#FF6B35" stroke-width="2.5" opacity="0.7" marker-end="url(#arrowhead1)"/>
            <text x="450" y="90" text-anchor="middle" font-size="12" fill="#FF6B35" font-weight="600">1 —á–µ–ª.</text>

            <!-- 2 ‚Üí 2.1 -->
            <defs>
                <marker id="arrowhead2" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                    <polygon points="0 0, 10 3, 0 6" fill="#4CAF50" />
                </marker>
            </defs>
            <path d="M 190 172 Q 450 247 710 247" fill="none" stroke="#4CAF50" stroke-width="3" opacity="0.7" marker-end="url(#arrowhead2)"/>
            <text x="450" y="240" text-anchor="middle" font-size="12" fill="#4CAF50" font-weight="600">2 —á–µ–ª.</text>

            <!-- 2.1 ‚Üí 2 -->
            <defs>
                <marker id="arrowhead3" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                    <polygon points="0 0, 10 3, 0 6" fill="#2196F3" />
                </marker>
            </defs>
            <path d="M 190 247 Q 450 172 710 172" fill="none" stroke="#2196F3" stroke-width="3.5" opacity="0.7" marker-end="url(#arrowhead3)"/>
            <text x="450" y="165" text-anchor="middle" font-size="12" fill="#2196F3" font-weight="600">3 —á–µ–ª.</text>

            <!-- 2.1 ‚Üí 2.2 -->
            <defs>
                <marker id="arrowhead4" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                    <polygon points="0 0, 10 3, 0 6" fill="#9C27B0" />
                </marker>
            </defs>
            <path d="M 190 247 Q 450 322 710 322" fill="none" stroke="#9C27B0" stroke-width="2" opacity="0.7" marker-end="url(#arrowhead4)"/>
            <text x="450" y="315" text-anchor="middle" font-size="12" fill="#9C27B0" font-weight="600">1 —á–µ–ª.</text>

            <!-- 2.2 ‚Üí 3 -->
            <defs>
                <marker id="arrowhead5" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                    <polygon points="0 0, 10 3, 0 6" fill="#FF5722" />
                </marker>
            </defs>
            <path d="M 190 322 Q 450 397 710 397" fill="none" stroke="#FF5722" stroke-width="2" opacity="0.7" marker-end="url(#arrowhead5)"/>
            <text x="450" y="390" text-anchor="middle" font-size="12" fill="#FF5722" font-weight="600">1 —á–µ–ª.</text>

            <!-- 3 ‚Üí 2.2 -->
            <defs>
                <marker id="arrowhead6" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                    <polygon points="0 0, 10 3, 0 6" fill="#FF9800" />
                </marker>
            </defs>
            <path d="M 190 397 Q 450 322 710 322" fill="none" stroke="#FF9800" stroke-width="2" opacity="0.7" marker-end="url(#arrowhead6)"/>
            <text x="450" y="345" text-anchor="middle" font-size="12" fill="#FF9800" font-weight="600">1 —á–µ–ª.</text>
        </svg>

        <div style="text-align: center; margin-top: 20px; color: var(--color-text-muted); font-size: 13px;">
            –î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –º–µ–∂–¥—É –≥—Ä—É–ø–ø–∞–º–∏ (—Ç–æ–ª—â–∏–Ω–∞ —Å—Ç—Ä–µ–ª–∫–∏ = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–µ–Ω–∏–∫–æ–≤)
        </div>
    </div>
</div>
{% endif %}

{% endblock %}
