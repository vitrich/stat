import os
import django

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'web.settings')
django.setup()

from main.models import Teacher, Group, Student, GroupHistory
from django.contrib.auth.models import User
from datetime import date

# –î–∞–Ω–Ω—ã–µ –∏–∑ Excel (–ò–°–ü–†–ê–í–õ–ï–ù–û: –í–∏—Ç—Ä–∏—á–µ–Ω–∫–æ –í. –≠.)
students_data = [
    # –ì—Ä—É–ø–ø–∞ 1 - –†–µ–Ω–∫–∞—Å –ò. –ê.
    {'name': '–ö–æ–Ω–¥—Ä–∞—à–∏–Ω –ú–∞—Ä–∫', 'group': 1, 'teacher': '–†–µ–Ω–∫–∞—Å –ò. –ê.'},
    {'name': '–ö–æ—Ä–æ–ª—å –î–µ–Ω–∏—Å', 'group': 1, 'teacher': '–†–µ–Ω–∫–∞—Å –ò. –ê.'},
    {'name': '–õ–æ–∑–æ–≤—Å–∫–∞—è –ï–∫–∞—Ç–µ—Ä–∏–Ω–∞', 'group': 1, 'teacher': '–†–µ–Ω–∫–∞—Å –ò. –ê.'},
    {'name': '–ú–≥–µ–±—Ä–æ–≤ –ê—Ä—Ç—ë–º', 'group': 1, 'teacher': '–†–µ–Ω–∫–∞—Å –ò. –ê.'},
    {'name': '–°–∞—Ä–≥—Å—è–Ω –ú–∞—Ä–∏–∞–º', 'group': 1, 'teacher': '–†–µ–Ω–∫–∞—Å –ò. –ê.'},

    # –ì—Ä—É–ø–ø–∞ 2 - –ö—Ä–µ—Å—Ç–Ω–∏–∫–æ–≤–∞ –ï. –í.
    {'name': '–ë–∞–±–µ–Ω–∫–æ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞', 'group': 2, 'teacher': '–ö—Ä–µ—Å—Ç–Ω–∏–∫–æ–≤–∞ –ï. –í.'},
    {'name': '–ö–æ—Å–º–∞—Ä—Å–∫–∏–π –ê–ª–µ–∫—Å–∞–Ω–¥—Ä', 'group': 2, 'teacher': '–ö—Ä–µ—Å—Ç–Ω–∏–∫–æ–≤–∞ –ï. –í.'},
    {'name': '–õ–µ–π—Ç–µ—Å –ú–∞—Ä–∫', 'group': 2, 'teacher': '–ö—Ä–µ—Å—Ç–Ω–∏–∫–æ–≤–∞ –ï. –í.'},
    {'name': '–ú–∞—Ä—Ç–∏—Ä–æ—Å—è–Ω –î–∞–≤–∏–¥', 'group': 2, 'teacher': '–ö—Ä–µ—Å—Ç–Ω–∏–∫–æ–≤–∞ –ï. –í.'},
    {'name': '–ù–æ–≤–æ–∂–µ–Ω–æ–≤ –Æ—Ä–∏–π', 'group': 2, 'teacher': '–ö—Ä–µ—Å—Ç–Ω–∏–∫–æ–≤–∞ –ï. –í.'},
    {'name': '–ü–µ—Ä–∏–Ω –î–∞–Ω–∏–∏–ª', 'group': 2, 'teacher': '–ö—Ä–µ—Å—Ç–Ω–∏–∫–æ–≤–∞ –ï. –í.'},
    {'name': '–¢–æ–∫–æ–≤–∏–Ω–∏–Ω –ï—Ñ–∏–º', 'group': 2, 'teacher': '–ö—Ä–µ—Å—Ç–Ω–∏–∫–æ–≤–∞ –ï. –í.'},

    # –ì—Ä—É–ø–ø–∞ 2.1 - –í–∏—Ç—Ä–∏—á–µ–Ω–∫–æ –í. –≠. (–ò–°–ü–†–ê–í–õ–ï–ù–û)
    {'name': '–ê–±–µ–ª—é–∫ –ú–∞—Ä–∏—è', 'group': 2.1, 'teacher': '–í–∏—Ç—Ä–∏—á–µ–Ω–∫–æ –í. –≠.'},
    {'name': '–ê–Ω–æ—à–∏–Ω –ú–∞—Ç–≤–µ–π', 'group': 2.1, 'teacher': '–í–∏—Ç—Ä–∏—á–µ–Ω–∫–æ –í. –≠.'},
    {'name': '–ì–æ–Ω—Ç–∞—Ä–µ–≤ –ò–ª—å—è', 'group': 2.1, 'teacher': '–í–∏—Ç—Ä–∏—á–µ–Ω–∫–æ –í. –≠.'},
    {'name': '–ï–≥–æ—Ä–æ–≤–∞ –ú–∏—Ä–æ—Å–ª–∞–≤–∞', 'group': 2.1, 'teacher': '–í–∏—Ç—Ä–∏—á–µ–Ω–∫–æ –í. –≠.'},
    {'name': '–ö–∞—Ä–Ω–∞—É—Ö –¢–∏–º–æ—Ñ–µ–π', 'group': 2.1, 'teacher': '–í–∏—Ç—Ä–∏—á–µ–Ω–∫–æ –í. –≠.'},
    {'name': '–ö–æ—Å—Ç–µ–Ω–∫–æ –ö–∞—Ä–æ–ª–∏–Ω–∞', 'group': 2.1, 'teacher': '–í–∏—Ç—Ä–∏—á–µ–Ω–∫–æ –í. –≠.'},
    {'name': '–ú–∏–Ω—Ü –ú–∞—Ä–∫', 'group': 2.1, 'teacher': '–í–∏—Ç—Ä–∏—á–µ–Ω–∫–æ –í. –≠.'},
    {'name': '–ü–æ–ª—è–∫–æ–≤ –ù–∏–∫–∏—Ç–∞', 'group': 2.1, 'teacher': '–í–∏—Ç—Ä–∏—á–µ–Ω–∫–æ –í. –≠.'},
    {'name': '–†—ã–ª—å—Å–∫–∞—è –≠–≤–∏–ª–∏–Ω–∞', 'group': 2.1, 'teacher': '–í–∏—Ç—Ä–∏—á–µ–Ω–∫–æ –í. –≠.'},
    {'name': '–°–∞—Ä–≥—Å—è–Ω –≠–º–∏–ª–∏—è', 'group': 2.1, 'teacher': '–í–∏—Ç—Ä–∏—á–µ–Ω–∫–æ –í. –≠.'},
    {'name': '–°—Ç—Ä–æ–∫–∞—Ç–æ–≤–∞ –ö–∏—Ä–∞', 'group': 2.1, 'teacher': '–í–∏—Ç—Ä–∏—á–µ–Ω–∫–æ –í. –≠.'},
    {'name': '–¢–∞–≤—Ä–∏–Ω–∞ –ú–∞—Ä–∏—è', 'group': 2.1, 'teacher': '–í–∏—Ç—Ä–∏—á–µ–Ω–∫–æ –í. –≠.'},

    # –ì—Ä—É–ø–ø–∞ 2.2 - –®—É–ª—è–µ–≤ –ú. –ò.
    {'name': '–ê–±–æ–ª–º–∞—Å–æ–≤–∞ –ê–Ω–Ω–∞', 'group': 2.2, 'teacher': '–®—É–ª—è–µ–≤ –ú. –ò.'},
    {'name': '–ë–µ–∫–º–µ—Ç–æ–≤ –î–º–∏—Ç—Ä–∏–π', 'group': 2.2, 'teacher': '–®—É–ª—è–µ–≤ –ú. –ò.'},
    {'name': '–í–∞—Å–∏–ª—å–µ–≤ –ú–∏—Ö–∞–∏–ª', 'group': 2.2, 'teacher': '–®—É–ª—è–µ–≤ –ú. –ò.'},
    {'name': '–í–µ—Ä—Ö–æ—Ç—É—Ä–æ–≤–∞ –ê—Ä–∏–Ω–∞', 'group': 2.2, 'teacher': '–®—É–ª—è–µ–≤ –ú. –ò.'},
    {'name': '–î–∞—Ä—Å–∏–≥–æ–≤ –î–∞–º–∏—Ä', 'group': 2.2, 'teacher': '–®—É–ª—è–µ–≤ –ú. –ò.'},
    {'name': '–î—è–∫–∏–Ω–∞ –õ–µ—è', 'group': 2.2, 'teacher': '–®—É–ª—è–µ–≤ –ú. –ò.'},
    {'name': '–ó–∏–º–∏–Ω–∞ –ú–∞—Ä–∏—è', 'group': 2.2, 'teacher': '–®—É–ª—è–µ–≤ –ú. –ò.'},
    {'name': '–ö–∞–π—Ç–º–∞–∑–æ–≤ –ú–∞—Ä–∞—Ç', 'group': 2.2, 'teacher': '–®—É–ª—è–µ–≤ –ú. –ò.'},
    {'name': '–ö–æ–Ω–¥—Ä–∞—Ç—é–∫ –ï–∫–∞—Ç–µ—Ä–∏–Ω–∞', 'group': 2.2, 'teacher': '–®—É–ª—è–µ–≤ –ú. –ò.'},
    {'name': '–ö—É–ª—å–±–∞—Ä–∏—Å–æ–≤–∞ –¢–∞–∏—Ä–∞', 'group': 2.2, 'teacher': '–®—É–ª—è–µ–≤ –ú. –ò.'},
    {'name': '–õ–æ–≥—É–Ω–æ–≤–∞ –ê—Ä–∏–Ω–∞', 'group': 2.2, 'teacher': '–®—É–ª—è–µ–≤ –ú. –ò.'},
    {'name': '–ú–µ—Ä–∫–∞ –ï–≥–æ—Ä', 'group': 2.2, 'teacher': '–®—É–ª—è–µ–≤ –ú. –ò.'},
    {'name': '–ú–æ–ª–æ–¥—Ü–æ–≤ –õ–µ–æ–Ω–∏–¥', 'group': 2.2, 'teacher': '–®—É–ª—è–µ–≤ –ú. –ò.'},
    {'name': '–ü–∞—Ç–∏–Ω–∞ –ê–≥–∞—Ç–∞', 'group': 2.2, 'teacher': '–®—É–ª—è–µ–≤ –ú. –ò.'},
    {'name': '–°–∞—Ö–∞—Ä–æ–≤–∞ –ï–∫–∞—Ç–µ—Ä–∏–Ω–∞', 'group': 2.2, 'teacher': '–®—É–ª—è–µ–≤ –ú. –ò.'},
    {'name': '–¢–∏—Ç–æ–≤–∞ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞', 'group': 2.2, 'teacher': '–®—É–ª—è–µ–≤ –ú. –ò.'},
    {'name': '–®–∞—Ä–æ–Ω–æ–≤–∞ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞', 'group': 2.2, 'teacher': '–®—É–ª—è–µ–≤ –ú. –ò.'},

    # –ì—Ä—É–ø–ø–∞ 3 - –§–∏—Å–µ–Ω–∫–æ –ï. –ú.
    {'name': '–ê–∫—Å–∞–∫–æ–≤–∞ –õ–∞–Ω–∞', 'group': 3, 'teacher': '–§–∏—Å–µ–Ω–∫–æ –ï. –ú.'},
    {'name': '–ê–ª–∏–µ–≤ –ê–¥–∞–º', 'group': 3, 'teacher': '–§–∏—Å–µ–Ω–∫–æ –ï. –ú.'},
    {'name': '–ê–Ω–¥—Ä–µ–µ–≤–∞ –ê—Ä–∏–Ω–∞', 'group': 3, 'teacher': '–§–∏—Å–µ–Ω–∫–æ –ï. –ú.'},
    {'name': '–ë–æ–±—Ä–æ–≤—Å–∫–∏–π –ú–∞—Ä–∫', 'group': 3, 'teacher': '–§–∏—Å–µ–Ω–∫–æ –ï. –ú.'},
    {'name': '–î–∂—É—Ä–∞–µ–≤ –ú–∞–Ω—Å—É—Ä', 'group': 3, 'teacher': '–§–∏—Å–µ–Ω–∫–æ –ï. –ú.'},
    {'name': '–î—é–∫–æ–≤–∞ –ú–∞—Ä–∏—è', 'group': 3, 'teacher': '–§–∏—Å–µ–Ω–∫–æ –ï. –ú.'},
    {'name': '–ò–≥–Ω–∞—Ö–∏–Ω–∞ –ü–æ–ª–∏–Ω–∞', 'group': 3, 'teacher': '–§–∏—Å–µ–Ω–∫–æ –ï. –ú.'},
    {'name': '–ö–∞—Ä–ø–æ–≤–∞ –ê–º–∞–ª–∏—è', 'group': 3, 'teacher': '–§–∏—Å–µ–Ω–∫–æ –ï. –ú.'},
    {'name': '–õ–∏—á–º–∞–Ω–æ–≤–∞ –î–∞—Ä—å—è', 'group': 3, 'teacher': '–§–∏—Å–µ–Ω–∫–æ –ï. –ú.'},
    {'name': '–õ–æ–≥—É–Ω–æ–≤–∞ –ê—Ä–∏–Ω–∞', 'group': 3, 'teacher': '–§–∏—Å–µ–Ω–∫–æ –ï. –ú.'},
    {'name': '–ú–æ—á–∞–ª–æ–≤ –°–µ—Ä–≥–µ–π', 'group': 3, 'teacher': '–§–∏—Å–µ–Ω–∫–æ –ï. –ú.'},
    {'name': '–ü–µ—á–∞—Ç–∫–∏–Ω –õ–µ–≤', 'group': 3, 'teacher': '–§–∏—Å–µ–Ω–∫–æ –ï. –ú.'},
    {'name': '–†–∞—Ö–º–µ—Ç–æ–≤ –ê—Ä—Ç—É—Ä', 'group': 3, 'teacher': '–§–∏—Å–µ–Ω–∫–æ –ï. –ú.'},
    {'name': '–†—ã–±–∏–Ω –ú–∞–∫—Å–∏–º', 'group': 3, 'teacher': '–§–∏—Å–µ–Ω–∫–æ –ï. –ú.'},
    {'name': '–°–æ–±–æ–¥–∞ –ú–∞—Ä–∏—è', 'group': 3, 'teacher': '–§–∏—Å–µ–Ω–∫–æ –ï. –ú.'},
    {'name': '–ß–∏—Ä–∫—É–Ω–æ–≤–∞ –¢–∞–∏—Å–∏—è', 'group': 3, 'teacher': '–§–∏—Å–µ–Ω–∫–æ –ï. –ú.'},
    {'name': '–®–∞–Ω–≥–∏–Ω–∞ –≠–ª–∏–Ω–∞', 'group': 3, 'teacher': '–§–∏—Å–µ–Ω–∫–æ –ï. –ú.'},
    {'name': '–®—É–ª—å–≥–∞ –ì—Ä–∏–≥–æ—Ä–∏–π', 'group': 3, 'teacher': '–§–∏—Å–µ–Ω–∫–æ –ï. –ú.'},
]


def import_data():
    print("üöÄ –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ –±–∞–∑—É...")
    print("=" * 80)

    # –°–æ–∑–¥–∞—ë–º –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π
    teachers_map = {}
    teacher_names = list(set([s['teacher'] for s in students_data]))

    print("\nüìö –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π...")
    for teacher_name in teacher_names:
        username = teacher_name.replace(' ', '_').replace('.', '').lower()
        user, created = User.objects.get_or_create(
            username=username,
            defaults={'first_name': teacher_name.split()[0]}
        )
        if created:
            user.set_password('teacher123')  # –í—Ä–µ–º–µ–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å
            user.save()
            print(f"  ‚úì –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {username}")

        teacher, created = Teacher.objects.get_or_create(
            user=user,
            defaults={'full_name': teacher_name}
        )
        teachers_map[teacher_name] = teacher
        if created:
            print(f"  ‚úì –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å: {teacher_name}")

    # –°–æ–∑–¥–∞—ë–º –≥—Ä—É–ø–ø—ã
    groups_map = {}
    colors = {
        1: '#630922',
        2: '#800021',
        2.1: '#aa1f7b',
        2.2: '#bd2e8d',
        3: '#da70d6'
    }

    print("\nüë• –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä—É–ø–ø...")
    for group_num in [1, 2, 2.1, 2.2, 3]:
        # –ù–∞—Ö–æ–¥–∏–º –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è –¥–ª—è —ç—Ç–æ–π –≥—Ä—É–ø–ø—ã
        teacher_for_group = None
        for s in students_data:
            if s['group'] == group_num:
                teacher_for_group = teachers_map[s['teacher']]
                break

        group, created = Group.objects.get_or_create(
            number=group_num,
            defaults={
                'teacher': teacher_for_group,
                'color': colors.get(group_num, '#bd2e8d')
            }
        )
        groups_map[group_num] = group
        if created:
            print(f"  ‚úì –ì—Ä—É–ø–ø–∞ {group_num} ({teacher_for_group.full_name})")

    # –°–æ–∑–¥–∞—ë–º —É—á–µ–Ω–∏–∫–æ–≤
    print("\nüë®‚Äçüéì –°–æ–∑–¥–∞–Ω–∏–µ —É—á–µ–Ω–∏–∫–æ–≤...")
    for s_data in students_data:
        student, created = Student.objects.get_or_create(
            full_name=s_data['name'],
            defaults={
                'current_group': groups_map[s_data['group']],
                'is_registered': False
            }
        )

        if created:
            # –°–æ–∑–¥–∞—ë–º –∑–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏–∏ (–ø–µ—Ä–≤—ã–π –ø–µ—Ä–µ—Ö–æ–¥)
            GroupHistory.objects.create(
                student=student,
                group=groups_map[s_data['group']],
                transfer_date=date(2025, 1, 12)  # –ù–∞—á–∞–ª–æ III —á–µ—Ç–≤–µ—Ä—Ç–∏
            )
            print(f"  ‚úì {s_data['name']} ‚Üí –ì—Ä—É–ø–ø–∞ {s_data['group']}")

    print("\n" + "=" * 80)
    print("‚úÖ –ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω!")
    print(f"üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:")
    print(f"  –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π: {Teacher.objects.count()}")
    print(f"  –ì—Ä—É–ø–ø: {Group.objects.count()}")
    print(f"  –£—á–µ–Ω–∏–∫–æ–≤: {Student.objects.count()}")
    print(f"  –ó–∞–ø–∏—Å–µ–π –≤ –∏—Å—Ç–æ—Ä–∏–∏: {GroupHistory.objects.count()}")
    print("=" * 80)


if __name__ == '__main__':
    import_data()
